{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π{% endblock %}

{% block page_title %}
    {% if current_user.is_authenticated %}
        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ current_user.login }}!
    {% else %}
        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ë–∞–∑—É –∑–Ω–∞–Ω–∏–π!
    {% endif %}
{% endblock %}

{% block main %}
<div>
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div style="text-align: center; padding: 2rem 0 3rem 0;">
        <h3 style="margin-bottom: 2rem; color: #333;">
            {% if current_user.is_authenticated %}
                –†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞! –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å—Ç–∞—Ç—å–∏, –¥–µ–ª–∏—Ç–µ—Å—å –∑–Ω–∞–Ω–∏—è–º–∏.
            {% else %}
                –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É! –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏ –¥–µ–ª–∏—Ç–µ—Å—å –∑–Ω–∞–Ω–∏—è–º–∏.
            {% endif %}
        </h3>
        
        <div style="display: flex; gap: 1rem; justify-content: center; margin: 2rem 0; flex-wrap: wrap;">
            <a href="{{ url_for('lab8.public_articles') }}" class="btn btn-primary" style="padding: 0.75rem 2rem;">
                üìö –í—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏
            </a>
            
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('lab8.create_article') }}" class="btn btn-primary" style="padding: 0.75rem 2rem; background: #4CAF50;">
                    ‚úçÔ∏è –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é
                </a>
                <a href="{{ url_for('lab8.article_list') }}" class="btn" style="padding: 0.75rem 2rem;">
                    üìÑ –ú–æ–∏ —Å—Ç–∞—Ç—å–∏
                </a>
            {% else %}
                <a href="{{ url_for('lab8.register') }}" class="btn btn-primary" style="padding: 0.75rem 2rem; background: #4CAF50;">
                    üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </a>
                <a href="{{ url_for('lab8.login') }}" class="btn" style="padding: 0.75rem 2rem;">
                    üîë –í–æ–π—Ç–∏
                </a>
            {% endif %}
        </div>
    </div>
    
    <!-- –ü–æ–∏—Å–∫ -->
    <div style="max-width: 600px; margin: 0 auto 3rem auto; padding: 2rem; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h4 style="text-align: center; margin-bottom: 1rem;">–ü–æ–∏—Å–∫ –ø–æ —Å—Ç–∞—Ç—å—è–º</h4>
        <form action="{{ url_for('lab8.search_articles') }}" method="get">
            <div style="display: flex; gap: 1rem;">
                <input type="search" 
                       name="q" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞..." 
                       style="flex: 1; padding: 0.75rem; border: 2px solid #667eea; border-radius: 4px;"
                       required>
                <button type="submit" class="btn btn-primary" style="padding: 0.75rem 1.5rem;">
                    üîç –ù–∞–π—Ç–∏
                </button>
            </div>
            {% if current_user.is_authenticated %}
            <div style="margin-top: 1rem; text-align: center; font-size: 0.875rem; color: #666;">
                –ü–æ–∏—Å–∫ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ –≤—Å–µ–º –ø—É–±–ª–∏—á–Ω—ã–º –∏ –≤–∞—à–∏–º —Å—Ç–∞—Ç—å—è–º
            </div>
            {% endif %}
        </form>
    </div>
    
    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ -->
    {% if latest_articles %}
    <div style="margin-bottom: 3rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</h3>
            <a href="{{ url_for('lab8.public_articles') }}" class="btn" style="color: #667eea;">
                –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí
            </a>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;">
            {% for article in latest_articles %}
            <div style="background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.3s;">
                <h4 style="margin: 0 0 1rem 0;">
                    <a href="{{ url_for('lab8.article_detail', article_id=article.id) }}" 
                       style="color: #333; text-decoration: none;">
                        {{ article.title }}
                    </a>
                </h4>
                
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                        {{ article.author.login|first|upper }}
                    </div>
                    <div>
                        <div style="font-weight: 500;">{{ article.author.login }}</div>
                        <div style="font-size: 0.875rem; color: #666;">
                            {{ article.created_at.strftime('%d.%m.%Y') if article.created_at else '–ë–µ–∑ –¥–∞—Ç—ã' }}
                        </div>
                    </div>
                </div>
                
                <p style="color: #555; line-height: 1.6; margin-bottom: 1rem;">
                    {{ article.article_text[:120] }}
                    {% if article.article_text|length > 120 %}...{% endif %}
                </p>
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #666; font-size: 0.875rem;">
                        {% if article.likes %}
                            ‚ù§Ô∏è {{ article.likes }} –ª–∞–π–∫–æ–≤
                        {% endif %}
                    </span>
                    <a href="{{ url_for('lab8.article_detail', article_id=article.id) }}" 
                       class="btn" style="padding: 0.5rem 1rem; background: #f0f0f0; color: #333;">
                        –ß–∏—Ç–∞—Ç—å
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ -->
    {% if popular_articles %}
    <div style="margin-bottom: 3rem;">
        <h3 style="margin-bottom: 1.5rem;">–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
            {% for article in popular_articles %}
            <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #667eea;">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <span style="background: #667eea; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">
                        {{ loop.index }}
                    </span>
                    <h4 style="margin: 0; flex: 1;">
                        <a href="{{ url_for('lab8.article_detail', article_id=article.id) }}" 
                           style="color: #333; text-decoration: none;">
                            {{ article.title|truncate(40) }}
                        </a>
                    </h4>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                    <span style="color: #666; font-size: 0.875rem;">
                        {{ article.author.login }}
                    </span>
                    <span style="color: #f44336;">
                        ‚ù§Ô∏è {{ article.likes or 0 }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 3rem;">
        <a href="{{ url_for('lab8.stats') }}" 
           style="background: white; padding: 1.5rem; border-radius: 8px; text-align: center; text-decoration: none; color: #333; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìä</div>
            <div style="font-weight: 500;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∞–π—Ç–∞</div>
        </a>
        
        <a href="{{ url_for('lab8.article_authors') }}" 
           style="background: white; padding: 1.5rem; border-radius: 8px; text-align: center; text-decoration: none; color: #333; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üë•</div>
            <div style="font-weight: 500;">–ê–≤—Ç–æ—Ä—ã</div>
            <div style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">–í—Å–µ –∞–≤—Ç–æ—Ä—ã —Å—Ç–∞—Ç–µ–π</div>
        </a>
        
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('lab8.profile') }}" 
           style="background: white; padding: 1.5rem; border-radius: 8px; text-align: center; text-decoration: none; color: #333; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üë§</div>
            <div style="font-weight: 500;">–ü—Ä–æ—Ñ–∏–ª—å</div>
            <div style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
        </a>
        {% else %}
        <a href="{{ url_for('lab8.register') }}" 
           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 8px; text-align: center; text-decoration: none; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üöÄ</div>
            <div style="font-weight: 500;">–ù–∞—á–∞—Ç—å</div>
            <div style="font-size: 0.875rem; opacity: 0.9; margin-top: 0.5rem;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</div>
        </a>
        {% endif %}
    </div>
</div>

<style>
    @media (max-width: 768px) {
        .btn {
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        .grid-container {
            grid-template-columns: 1fr;
        }
    }
</style>

<script>
    // AJAX –ø–æ–∏—Å–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
    document.addEventListener('DOMContentLoaded', function() {
        const searchForm = document.querySelector('form[action*="search"]');
        if (searchForm) {
            const searchInput = searchForm.querySelector('input[name="q"]');
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Ctrl+K
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
            });
            
            // –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ Ctrl+K
            searchInput.addEventListener('focus', function() {
                this.setAttribute('title', '–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+K –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞');
            });
        }
    });
</script>
{% endblock %}
  